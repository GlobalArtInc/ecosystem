"use strict";(globalThis.webpackChunkdocs=globalThis.webpackChunkdocs||[]).push([[140],{6416(e,n,s){s.d(n,{R:()=>o,x:()=>l});var r=s(2128);const t={},i=r.createContext(t);function o(e){const n=r.useContext(i);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:o(e.components),r.createElement(i.Provider,{value:n},e.children)}},6609(e,n,s){s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>p,frontMatter:()=>o,metadata:()=>r,toc:()=>c});const r=JSON.parse('{"id":"packages/passport","title":"@globalart/passport","description":"OpenID Connect strategy for GlobalArt SSO integration. Provides Passport.js strategy and standalone authentication utilities for seamless integration with GlobalArt Single Sign-On.","source":"@site/content/packages/passport.mdx","sourceDirName":"packages","slug":"/packages/passport","permalink":"/packages/passport","draft":false,"unlisted":false,"editUrl":"https://github.com/GlobalArtInc/ecosystem/tree/main/docs/content/packages/passport.mdx","tags":[],"version":"current","sidebarPosition":8,"frontMatter":{"sidebar_position":8},"sidebar":"tutorialSidebar","previous":{"title":"@globalart/zod-to-proto","permalink":"/packages/zod-to-proto"},"next":{"title":"@globalart/oxide","permalink":"/packages/oxide"}}');var t=s(7900),i=s(6416);const o={sidebar_position:8},l="@globalart/passport",a={},c=[{value:"Installation",id:"installation",level:2},{value:"Overview",id:"overview",level:2},{value:"Key Features",id:"key-features",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Using with Passport.js",id:"using-with-passportjs",level:3},{value:"Using Standalone Auth Strategy",id:"using-standalone-auth-strategy",level:3},{value:"Configuration",id:"configuration",level:2},{value:"OpenIDConnectStrategyOptions",id:"openidconnectstrategyoptions",level:3},{value:"PassportGlobalArtOptions",id:"passportglobalartoptions",level:3},{value:"API Reference",id:"api-reference",level:2},{value:"GlobalArtPassportStrategy",id:"globalartpassportstrategy",level:3},{value:"GlobalArtAuthStrategy",id:"globalartauthstrategy",level:3},{value:"<code>initialize(): Promise&lt;void&gt;</code>",id:"initialize-promisevoid",level:4},{value:"<code>generateAuthorizationUrl(options?: AuthorizationUrlOptions): string</code>",id:"generateauthorizationurloptions-authorizationurloptions-string",level:4},{value:"<code>exchangeCodeForToken(code: string, codeVerifier?: string): Promise&lt;TokenResponse&gt;</code>",id:"exchangecodefortokencode-string-codeverifier-string-promisetokenresponse",level:4},{value:"<code>refreshToken(refreshToken: string): Promise&lt;TokenResponse&gt;</code>",id:"refreshtokenrefreshtoken-string-promisetokenresponse",level:4},{value:"<code>getUserInfo(accessToken: string): Promise&lt;GlobalArtUserInfo&gt;</code>",id:"getuserinfoaccesstoken-string-promiseglobalartuserinfo",level:4},{value:"<code>revokeToken(token: string, tokenTypeHint?: string): Promise&lt;void&gt;</code>",id:"revoketokentoken-string-tokentypehint-string-promisevoid",level:4},{value:"<code>getConfiguration(): OpenIDConnectConfig | null</code>",id:"getconfiguration-openidconnectconfig--null",level:4},{value:"UserMapper",id:"usermapper",level:3},{value:"<code>toUserInfo(userInfo: AccessTokenUserInfo): GlobalArtUserInfo</code>",id:"touserinfouserinfo-accesstokenuserinfo-globalartuserinfo",level:4},{value:"Types",id:"types",level:2},{value:"GlobalArtUserInfo",id:"globalartuserinfo",level:3},{value:"TokenResponse",id:"tokenresponse",level:3},{value:"OpenIDConnectConfig",id:"openidconnectconfig",level:3},{value:"Usage Examples",id:"usage-examples",level:2},{value:"Complete Express Application",id:"complete-express-application",level:3},{value:"Using PKCE (Proof Key for Code Exchange)",id:"using-pkce-proof-key-for-code-exchange",level:3},{value:"Token Refresh Flow",id:"token-refresh-flow",level:3},{value:"Custom Discovery URL",id:"custom-discovery-url",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"Security Considerations",id:"security-considerations",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Strategy Not Initialized",id:"strategy-not-initialized",level:3},{value:"Token Exchange Fails",id:"token-exchange-fails",level:3},{value:"User Info Retrieval Fails",id:"user-info-retrieval-fails",level:3}];function d(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"globalartpassport",children:"@globalart/passport"})}),"\n",(0,t.jsx)(n.p,{children:"OpenID Connect strategy for GlobalArt SSO integration. Provides Passport.js strategy and standalone authentication utilities for seamless integration with GlobalArt Single Sign-On."}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",metastring:"npm2yarn",children:"npm install @globalart/passport passport express express-session\n"})}),"\n",(0,t.jsx)(n.h2,{id:"overview",children:"Overview"}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"@globalart/passport"})," package provides authentication capabilities for applications integrating with GlobalArt SSO using OpenID Connect protocol. It includes:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Passport Strategy"})," - Ready-to-use Passport.js strategy for Express applications"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Standalone Auth Strategy"})," - Core authentication logic that can be used independently"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"User Mapping"})," - Automatic mapping of OpenID Connect user claims to application user model"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Token Management"})," - Support for access tokens, refresh tokens, and token revocation"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"key-features",children:"Key Features"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"OpenID Connect Support"})," - Full OIDC protocol implementation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Passport.js Integration"})," - Seamless integration with Passport.js middleware"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Automatic Discovery"})," - Automatic OpenID Connect configuration discovery"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Token Refresh"})," - Built-in support for token refresh"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Token Revocation"})," - Support for token revocation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Type Safety"})," - Full TypeScript support with proper types"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,t.jsx)(n.h3,{id:"using-with-passportjs",children:"Using with Passport.js"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import express from "express";\nimport passport from "passport";\nimport session from "express-session";\nimport { GlobalArtPassportStrategy } from "@globalart/passport";\n\nconst app = express();\n\napp.use(\n  session({\n    secret: "your-secret-key",\n    resave: false,\n    saveUninitialized: false,\n  })\n);\n\napp.use(passport.initialize());\napp.use(passport.session());\n\npassport.use(\n  new GlobalArtPassportStrategy(\n    {\n      clientId: process.env.CLIENT_ID!,\n      clientSecret: process.env.CLIENT_SECRET!,\n      redirectUri: process.env.REDIRECT_URI!,\n      scope: ["openid", "profile", "email"],\n    },\n    (req, accessToken, refreshToken, profile, done) => {\n      const user = {\n        id: profile.id,\n        email: profile.email,\n        name: profile.name,\n        accessToken,\n        refreshToken,\n      };\n      return done(null, user);\n    }\n  )\n);\n\npassport.serializeUser((user: any, done) => {\n  done(null, user.id);\n});\n\npassport.deserializeUser((id: string, done) => {\n  done(null, { id });\n});\n\napp.get("/auth/globalart", passport.authenticate("globalart"));\n\napp.get(\n  "/auth/globalart/callback",\n  passport.authenticate("globalart", { failureRedirect: "/login" }),\n  (req, res) => {\n    res.redirect("/profile");\n  }\n);\n\napp.get("/profile", (req, res) => {\n  if (req.isAuthenticated()) {\n    res.json({ user: req.user });\n  } else {\n    res.redirect("/auth/globalart");\n  }\n});\n'})}),"\n",(0,t.jsx)(n.h3,{id:"using-standalone-auth-strategy",children:"Using Standalone Auth Strategy"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { GlobalArtAuthStrategy } from "@globalart/passport";\n\nconst authStrategy = new GlobalArtAuthStrategy({\n  clientId: process.env.CLIENT_ID!,\n  clientSecret: process.env.CLIENT_SECRET!,\n  redirectUri: process.env.REDIRECT_URI!,\n  scope: ["openid", "profile", "email"],\n});\n\nawait authStrategy.initialize();\n\nconst authUrl = authStrategy.generateAuthorizationUrl({\n  state: "random-state-value",\n  nonce: "random-nonce-value",\n});\n\nconsole.log("Authorization URL:", authUrl);\n'})}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsx)(n.h3,{id:"openidconnectstrategyoptions",children:"OpenIDConnectStrategyOptions"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Option"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Required"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"clientId"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"OAuth2 client ID"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"clientSecret"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"OAuth2 client secret"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"redirectUri"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"OAuth2 redirect URI"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"responseType"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:'Response type (default: "code")'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"scope"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string[]"})}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:'OAuth2 scopes (default: ["openid", "profile", "email"])'})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"responseMode"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"Response mode"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"discoveryUrl"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"string"})}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"OpenID Connect discovery URL (default: GlobalArt SSO)"})]})]})]}),"\n",(0,t.jsx)(n.h3,{id:"passportglobalartoptions",children:"PassportGlobalArtOptions"}),"\n",(0,t.jsxs)(n.p,{children:["Extends ",(0,t.jsx)(n.code,{children:"OpenIDConnectStrategyOptions"})," with:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Option"}),(0,t.jsx)(n.th,{children:"Type"}),(0,t.jsx)(n.th,{children:"Required"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsx)(n.tbody,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"passReqToCallback"})}),(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"boolean"})}),(0,t.jsx)(n.td,{children:"No"}),(0,t.jsx)(n.td,{children:"Pass request object to verify callback"})]})})]}),"\n",(0,t.jsx)(n.h2,{id:"api-reference",children:"API Reference"}),"\n",(0,t.jsx)(n.h3,{id:"globalartpassportstrategy",children:"GlobalArtPassportStrategy"}),"\n",(0,t.jsx)(n.p,{children:"Passport.js strategy for GlobalArt SSO authentication."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Constructor:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"new GlobalArtPassportStrategy(\n  options: PassportGlobalArtOptions,\n  verify: (\n    req: Request,\n    accessToken: string,\n    refreshToken: string | undefined,\n    profile: GlobalArtUserInfo,\n    done: (error: Error | null, user?: GlobalArtUserInfo) => void\n  ) => void\n)\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Strategy Name:"})," ",(0,t.jsx)(n.code,{children:'"globalart"'})]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'passport.use(\n  new GlobalArtPassportStrategy(\n    {\n      clientId: "your-client-id",\n      clientSecret: "your-client-secret",\n      redirectUri: "http://localhost:3000/auth/globalart/callback",\n    },\n    (req, accessToken, refreshToken, profile, done) => {\n      return done(null, profile);\n    }\n  )\n);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"globalartauthstrategy",children:"GlobalArtAuthStrategy"}),"\n",(0,t.jsx)(n.p,{children:"Standalone authentication strategy for OpenID Connect flows."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Constructor:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"new GlobalArtAuthStrategy(options: OpenIDConnectStrategyOptions)\n"})}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Methods:"})}),"\n",(0,t.jsx)(n.h4,{id:"initialize-promisevoid",children:(0,t.jsx)(n.code,{children:"initialize(): Promise<void>"})}),"\n",(0,t.jsx)(n.p,{children:"Initializes the strategy by loading OpenID Connect configuration from the discovery endpoint."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"await authStrategy.initialize();\n"})}),"\n",(0,t.jsx)(n.h4,{id:"generateauthorizationurloptions-authorizationurloptions-string",children:(0,t.jsx)(n.code,{children:"generateAuthorizationUrl(options?: AuthorizationUrlOptions): string"})}),"\n",(0,t.jsx)(n.p,{children:"Generates the authorization URL for initiating the OAuth2 flow."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"options"})," (optional): ",(0,t.jsx)(n.code,{children:"AuthorizationUrlOptions"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"state"})," - State parameter for CSRF protection"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"nonce"})," - Nonce for ID token validation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"codeChallenge"})," - PKCE code challenge"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"codeChallengeMethod"}),' - PKCE code challenge method (e.g., "S256")']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"prompt"}),' - Prompt parameter (e.g., "login", "consent")']}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"maxAge"})," - Maximum authentication age"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"loginHint"})," - Login hint for the user"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"acrValues"})," - Authentication Context Class Reference values"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"string"})," - Authorization URL"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'const authUrl = authStrategy.generateAuthorizationUrl({\n  state: "random-state",\n  nonce: "random-nonce",\n  codeChallenge: "code-challenge",\n  codeChallengeMethod: "S256",\n});\n'})}),"\n",(0,t.jsx)(n.h4,{id:"exchangecodefortokencode-string-codeverifier-string-promisetokenresponse",children:(0,t.jsx)(n.code,{children:"exchangeCodeForToken(code: string, codeVerifier?: string): Promise<TokenResponse>"})}),"\n",(0,t.jsx)(n.p,{children:"Exchanges authorization code for access token."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"code"})," - Authorization code from callback"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"codeVerifier"})," - PKCE code verifier (optional)"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"Promise<TokenResponse>"})," - Token response with access token, refresh token, etc."]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const tokenResponse = await authStrategy.exchangeCodeForToken(\n  authorizationCode,\n  codeVerifier\n);\n\nconsole.log(tokenResponse.access_token);\nconsole.log(tokenResponse.refresh_token);\n"})}),"\n",(0,t.jsx)(n.h4,{id:"refreshtokenrefreshtoken-string-promisetokenresponse",children:(0,t.jsx)(n.code,{children:"refreshToken(refreshToken: string): Promise<TokenResponse>"})}),"\n",(0,t.jsx)(n.p,{children:"Refreshes an access token using a refresh token."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"refreshToken"})," - Refresh token"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"Promise<TokenResponse>"})," - New token response"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const newTokenResponse = await authStrategy.refreshToken(refreshToken);\n"})}),"\n",(0,t.jsx)(n.h4,{id:"getuserinfoaccesstoken-string-promiseglobalartuserinfo",children:(0,t.jsx)(n.code,{children:"getUserInfo(accessToken: string): Promise<GlobalArtUserInfo>"})}),"\n",(0,t.jsx)(n.p,{children:"Retrieves user information using an access token."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"accessToken"})," - Access token"]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"Promise<GlobalArtUserInfo>"})," - User information"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"const userInfo = await authStrategy.getUserInfo(accessToken);\nconsole.log(userInfo.id, userInfo.email, userInfo.name);\n"})}),"\n",(0,t.jsx)(n.h4,{id:"revoketokentoken-string-tokentypehint-string-promisevoid",children:(0,t.jsx)(n.code,{children:"revokeToken(token: string, tokenTypeHint?: string): Promise<void>"})}),"\n",(0,t.jsx)(n.p,{children:"Revokes an access or refresh token."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Parameters:"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"token"})," - Token to revoke"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"tokenTypeHint"}),' - Token type hint ("access_token" or "refresh_token")']}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'await authStrategy.revokeToken(accessToken, "access_token");\n'})}),"\n",(0,t.jsx)(n.h4,{id:"getconfiguration-openidconnectconfig--null",children:(0,t.jsx)(n.code,{children:"getConfiguration(): OpenIDConnectConfig | null"})}),"\n",(0,t.jsx)(n.p,{children:"Returns the loaded OpenID Connect configuration."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Returns:"})," ",(0,t.jsx)(n.code,{children:"OpenIDConnectConfig | null"})," - Configuration or null if not initialized"]}),"\n",(0,t.jsx)(n.h3,{id:"usermapper",children:"UserMapper"}),"\n",(0,t.jsx)(n.p,{children:"Utility class for mapping OpenID Connect user claims."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Methods:"})}),"\n",(0,t.jsx)(n.h4,{id:"touserinfouserinfo-accesstokenuserinfo-globalartuserinfo",children:(0,t.jsx)(n.code,{children:"toUserInfo(userInfo: AccessTokenUserInfo): GlobalArtUserInfo"})}),"\n",(0,t.jsx)(n.p,{children:"Maps OpenID Connect user claims to GlobalArt user info format."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Example:"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { UserMapper } from "@globalart/passport";\n\nconst globalArtUser = UserMapper.toUserInfo(oidcUserInfo);\n'})}),"\n",(0,t.jsx)(n.h2,{id:"types",children:"Types"}),"\n",(0,t.jsx)(n.h3,{id:"globalartuserinfo",children:"GlobalArtUserInfo"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface GlobalArtUserInfo {\n  id: number;\n  email: string;\n  name: string;\n  given_name?: string;\n  family_name?: string;\n  preferred_username?: string;\n  locale?: string;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"tokenresponse",children:"TokenResponse"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface TokenResponse {\n  access_token: string;\n  token_type: string;\n  expires_in: number;\n  refresh_token?: string;\n  id_token?: string;\n  scope?: string;\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"openidconnectconfig",children:"OpenIDConnectConfig"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"interface OpenIDConnectConfig {\n  issuer: string;\n  authorization_endpoint: string;\n  token_endpoint: string;\n  userinfo_endpoint: string;\n  jwks_uri: string;\n  revocation_endpoint: string;\n  response_types_supported: string[];\n  response_modes_supported: string[];\n  subject_types_supported: string[];\n  token_endpoint_auth_methods_supported: string[];\n  id_token_signing_alg_values_supported: string[];\n  scopes_supported: string[];\n  claims_supported: string[];\n  code_challenge_methods_supported: string[];\n  grant_types_supported: string[];\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"usage-examples",children:"Usage Examples"}),"\n",(0,t.jsx)(n.h3,{id:"complete-express-application",children:"Complete Express Application"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import express from "express";\nimport passport from "passport";\nimport session from "express-session";\nimport { GlobalArtPassportStrategy } from "@globalart/passport";\n\nconst app = express();\n\napp.use(\n  session({\n    secret: process.env.SESSION_SECRET!,\n    resave: false,\n    saveUninitialized: false,\n  })\n);\n\napp.use(passport.initialize());\napp.use(passport.session());\n\npassport.use(\n  new GlobalArtPassportStrategy(\n    {\n      clientId: process.env.CLIENT_ID!,\n      clientSecret: process.env.CLIENT_SECRET!,\n      redirectUri: `${process.env.APP_URL}/auth/globalart/callback`,\n      scope: ["openid", "profile", "email"],\n    },\n    async (req, accessToken, refreshToken, profile, done) => {\n      try {\n        const user = await findOrCreateUser({\n          id: profile.id,\n          email: profile.email,\n          name: profile.name,\n        });\n\n        user.accessToken = accessToken;\n        user.refreshToken = refreshToken;\n\n        return done(null, user);\n      } catch (error) {\n        return done(error);\n      }\n    }\n  )\n);\n\npassport.serializeUser((user: any, done) => {\n  done(null, user.id);\n});\n\npassport.deserializeUser(async (id: string, done) => {\n  try {\n    const user = await findUserById(id);\n    done(null, user);\n  } catch (error) {\n    done(error);\n  }\n});\n\napp.get("/auth/globalart", passport.authenticate("globalart"));\n\napp.get(\n  "/auth/globalart/callback",\n  passport.authenticate("globalart", {\n    failureRedirect: "/login",\n    successRedirect: "/dashboard",\n  })\n);\n\napp.get("/logout", (req, res) => {\n  req.logout(() => {\n    res.redirect("/");\n  });\n});\n\napp.listen(3000);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"using-pkce-proof-key-for-code-exchange",children:"Using PKCE (Proof Key for Code Exchange)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import crypto from "crypto";\nimport { GlobalArtAuthStrategy } from "@globalart/passport";\n\nconst authStrategy = new GlobalArtAuthStrategy({\n  clientId: process.env.CLIENT_ID!,\n  clientSecret: process.env.CLIENT_SECRET!,\n  redirectUri: process.env.REDIRECT_URI!,\n});\n\nawait authStrategy.initialize();\n\nconst codeVerifier = crypto.randomBytes(32).toString("base64url");\nconst codeChallenge = crypto\n  .createHash("sha256")\n  .update(codeVerifier)\n  .digest("base64url");\n\nconst authUrl = authStrategy.generateAuthorizationUrl({\n  state: crypto.randomBytes(16).toString("hex"),\n  nonce: crypto.randomBytes(16).toString("hex"),\n  codeChallenge,\n  codeChallengeMethod: "S256",\n});\n\nconsole.log("Visit:", authUrl);\nconsole.log("Save codeVerifier:", codeVerifier);\n\nconst tokenResponse = await authStrategy.exchangeCodeForToken(\n  authorizationCode,\n  codeVerifier\n);\n'})}),"\n",(0,t.jsx)(n.h3,{id:"token-refresh-flow",children:"Token Refresh Flow"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { GlobalArtAuthStrategy } from "@globalart/passport";\n\nconst authStrategy = new GlobalArtAuthStrategy({\n  clientId: process.env.CLIENT_ID!,\n  clientSecret: process.env.CLIENT_SECRET!,\n  redirectUri: process.env.REDIRECT_URI!,\n});\n\nawait authStrategy.initialize();\n\ntry {\n  const newTokenResponse = await authStrategy.refreshToken(refreshToken);\n  console.log("New access token:", newTokenResponse.access_token);\n} catch (error) {\n  console.error("Token refresh failed:", error);\n}\n'})}),"\n",(0,t.jsx)(n.h3,{id:"custom-discovery-url",children:"Custom Discovery URL"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:'import { GlobalArtAuthStrategy } from "@globalart/passport";\n\nconst authStrategy = new GlobalArtAuthStrategy({\n  clientId: process.env.CLIENT_ID!,\n  clientSecret: process.env.CLIENT_SECRET!,\n  redirectUri: process.env.REDIRECT_URI!,\n  discoveryUrl:\n    "https://custom-sso.example.com/.well-known/openid-configuration",\n});\n\nawait authStrategy.initialize();\n'})}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Use PKCE"})," - Always use PKCE for public clients to enhance security"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Store Tokens Securely"})," - Store access tokens and refresh tokens securely (encrypted)"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Handle Token Expiration"})," - Implement token refresh logic before tokens expire"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Validate State"})," - Always validate the state parameter to prevent CSRF attacks"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Error Handling"})," - Implement proper error handling for authentication failures"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Session Management"})," - Use secure session configuration in production"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"HTTPS Only"})," - Always use HTTPS in production for secure token transmission"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"security-considerations",children:"Security Considerations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Client Secret"})," - Never expose client secret in client-side code"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"State Parameter"})," - Always use and validate state parameter for CSRF protection"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Token Storage"})," - Store tokens securely and never expose them in URLs or logs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"HTTPS"})," - Use HTTPS for all authentication endpoints"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Token Expiration"})," - Respect token expiration times and refresh tokens when needed"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Token Revocation"})," - Implement token revocation on logout"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"strategy-not-initialized",children:"Strategy Not Initialized"}),"\n",(0,t.jsxs)(n.p,{children:['If you get "Strategy not initialized" error, make sure to call ',(0,t.jsx)(n.code,{children:"initialize()"})," before using other methods:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-typescript",children:"await authStrategy.initialize();\n"})}),"\n",(0,t.jsx)(n.h3,{id:"token-exchange-fails",children:"Token Exchange Fails"}),"\n",(0,t.jsx)(n.p,{children:"Check that:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Authorization code is valid and not expired"}),"\n",(0,t.jsx)(n.li,{children:"Redirect URI matches exactly (including trailing slashes)"}),"\n",(0,t.jsx)(n.li,{children:"Client credentials are correct"}),"\n",(0,t.jsx)(n.li,{children:"Code verifier matches code challenge (if using PKCE)"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"user-info-retrieval-fails",children:"User Info Retrieval Fails"}),"\n",(0,t.jsx)(n.p,{children:"Ensure:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Access token is valid and not expired"}),"\n",(0,t.jsx)(n.li,{children:'Access token has required scopes (e.g., "openid", "profile", "email")'}),"\n",(0,t.jsx)(n.li,{children:"User info endpoint is accessible"}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}}}]);